function removeReplyArea(e){$(e).parent().siblings(".reply-area").remove()}function enableBtSave(e){e.removeClass("btn-success"),e.addClass("btn-danger"),e.removeAttr("disabled")}function addMyScheme(e,t){var n="",r="",i=$("#bt-scheme-ensure"),s=$("#my_project").find("span");i.button("loading");try{var o=document.getElementsByTagName("input");for(var u=0;u<o.length;u++)if(o[u].type=="radio"&&o[u].checked){n==""&&(n=o[u].value.split("|")[2]);var a=$(o[u]).parent(),f=a.parent();r+=a.prev().prev().html();for(var l=1;l<a.attr("rowspan");++l){var c=f.next().children();r+=$(c.get(5)).html(),f=f.next()}}}catch(h){console.log(h)}r==""&&(r="选课时间获取错误！");var p=n.split("@")[0],d=n.split("@")[1],v=$("#dialog-summary");v.empty(),$.ajax({type:"POST",contentType:"application/x-www-form-urlencoded; charset=UTF-8",url:"../action/addScheme",data:{cNo:e,displayValue:p,formValue:d,schoolTime:r},error:function(e){dg_addErrorMassage("服务器出错，请联系管理员",v),i.button("reset");return},success:function(e){if(e==""){dg_addErrorMassage("提交失败，请重试！",v),i.button("reset");return}if(e=="update success"){$("#CourseChoose-dialog").modal("hide"),showAlert("消息","更新成功",t);return}if(e=="addScheme success"){if(s.size()==0){var n='<span class="badge pull-right">1</span>我的选课方案';$("#my_project").children("a").html(n)}else s.html(parseInt(s.html())+1);$("#CourseChoose-dialog").modal("hide"),showAlert("消息","添加成功",t);return}}})}function showAlert(e,t,n,r){$("#alert-dialog").find("#myModalLabel").html(e),$("#alert-dialog").find(".modal-body").html(t),$("#alert-dialog").modal("show"),typeof n=="function"&&$("#alert-dialog").find("button").one("click",n),(r=="undefined"||r==null)&&setTimeout(function(){$("#alert-dialog").modal("hide"),typeof n=="function"&&n()},4e3)}function refalshPageInfo(){var cNo=$("#cNo").html();$.get("../action/remark",{cNo:cNo,action:"getRemark"},function(data){if(data=="")return;var obj=eval("("+data+")");obj["remarkItem"]==1?refalshRemarkInfo(1,$("#remark_good").children().last().html()):obj["remarkItem"]==2&&refalshRemarkInfo(2,$("#remark_bad").children().last().html())})}function refalshRemarkInfo(e,t){var n=$("#remark_good"),r=$("#remark_bad");e==1&&(n.children().last().html("已赞 "+t),n.addClass("disabled"),r.addClass("disabled")),e==2&&(r.children().last().html("已踩 "+t),r.addClass("disabled"),n.addClass("disabled"))}function bindAccount(url,sno,password,summaryNode,nodeToappend,nodeToHide,messageNode,button){$.ajax({type:"POST",contentType:"application/x-www-form-urlencoded; charset=UTF-8",url:url,async:!0,data:{action:"bind",password:password,sno:sno},error:function(e){dg_addErrorMassage("服务器出错，请联系管理员",summaryNode),button.button("reset");return},success:function(data){if(data==""){dg_addErrorMassage("服务器出错，请联系管理员",summaryNode),button.button("reset");return}var obj=eval("("+decodeURIComponent(data)+")");if(obj["error"]=="00003"){dg_addErrorMassage("学号或密码不正确",summaryNode),button.button("reset");return}if(obj["error"]=="00002"){dg_addErrorMassage("教务网阻塞，暂时无法通信",summaryNode),button.button("reset");return}if(obj["error"]=="-00001"){dg_addErrorMassage("未知错误，绑定失败",summaryNode),button.button("reset");return}if(obj.success){var tableNode=$(obj.myInfo);nodeToappend.empty(),tableNode.appendTo(nodeToappend),nodeToappend.show(),nodeToHide.hide(),messageNode&&messageNode.html("(已绑定)"),location.reload();return}}})}function dg_addErrorMassage(e,t){var n=$("<p>"+e+"</p>");n.appendTo(t),t.show()}function isChinese(e){var t=/[^\u4e00-\u9fa5]/;return t.test(e)?!1:!0}function isEmail(e){return reg=/^([\w-\.]+)@((\[[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\.)|(([\w-]+\.)+))([a-zA-Z]{2,4}|[0-9]{1,3})(\]?)$/,reg.test(e)?!0:!1}function checkPassword(e){return e.length>=6&&e.length<=16?!0:!1}function isSno(e){var t=/^([0-9]{12})$/;return t.test(e)?!0:!1}function showMyConfirm(e,t){var n='<div class="modal fade" id="my-confirm" tabindex="-1" role="dialog"';n+='aria-labelledby="myModalLabel" aria-hidden="true" data-backdrop="static">',n+='	<div class="modal-dialog">',n+='<div class="modal-content">',n+='<div class="modal-header">',n+='<button type="button" class="close" data-dismiss="modal"',n+='aria-hidden="true">&times;</button>',n+='	<h4 class="modal-title" id="myModalLabel">确认</h4>',n+="	</div>",n+='<div class="modal-body">'+e+"</div>",n+='	<div class="modal-footer">',n+='	<button type="button" class="btn btn-primary ensure">确定</button>',n+='	<button type="button" class="btn btn-default" data-dismiss="modal">取消</button>',n+="	</div>",n+="	</div>",n+="	</div>",n+="	</div>";var r=$(n);return r.on("click",".ensure",function(e){$("#my-confirm").modal("hide"),t()}),r.on("hidden.bs.modal",function(){r.remove()}),$("body").append(r),$("#my-confirm").modal("show"),r}function deleteComment(e){showMyConfirm("你确定删除此条评论吗?",function(){$.get("../action/deleteComment",{pccid:e},function(e){if(e==""){showAlert("错误","删除失败，请刷新页面重试！");return}if(e=="comment delete success"){showAlert("消息","删除成功",fun_page_reload);return}if(e=="less permission"){showAlert("消息","没有权限");return}})})}function showReplyInputArea(e,t){var n=$('<div class="reply-area clearfix"><textarea placeholder="'+t+'" name="reply-content" class="texta-reply form-control"></textarea><button type="submit" data-loading-text="发表中..." class="btn btn-warning btn-sm pull-right">评论</button></div>');$(e).parent().after(n);var r=n.find(".btn"),i=n.find("textarea");r.click(function(){var e=i.val();if(e==""){showAlert("错误","回复内容不能为空");return}var t=n.parent().parent().attr("pccid")||n.parent().parent().parent().attr("pccid"),r=n.parent().parent().parent().parent().parent().attr("pccid")||n.parent().parent().parent().attr("pccid")||n.parent().parent().attr("parent_pccid"),s=n.parent().siblings(".nickName").attr("uid")||n.parent().parent().siblings(".user-info").find(".nickName").attr("uid")||n.parent().find(".commentUserName").attr("uid"),o=$("#cNo").html(),u="";o==undefined?(o=n.parent().parent().attr("cNo"),u="directReply"):u="replyComment",createComment(u,o,e,r,s)})}function createComment(actionItem,cNo,content,parent_pccid,reply_uid){$.ajax({type:"POST",url:"../action/comment",async:!1,data:{action:actionItem,cNo:cNo,content:content,parent_pccid:parent_pccid,reply_uid:reply_uid},success:function(data){if(data==""){showAlert("消息","服务器出错");return}var obj=eval("("+data+")");if(checkIsLogin(obj)&&obj.success){if(actionItem=="directReply"){location.href="comment?tab=myComment";return}location.reload()}}})}function checkIsLogin(e){return e.error?(e["error"]=="unlogined"&&(setRemarkAction("enable"),showAlert("消息","请登录后操作！")),!1):!0}var redirect_uri="http://zhkuas.duapp.com/account/callback",fun_page_reload=function(){location.reload()},currentTermName="2013-2014第二学期",currentTermNo="20131";$(function(){$(".messageAlert").hide();var e=setInterval(function(){getUnreadMention()},1e3),t="";$("#bt_close").click(function(){$(".messageAlert").hide(),clearInterval(e)}),getUnreadMention=function(){$.ajax({url:"../action/getCommentNotice",dataType:"html",success:function(n){if(t!=n){if(n=="login out time"){clearInterval(e);return}t==""&&(clearInterval(e),e=setInterval(function(){getUnreadMention()},3e4)),t=n,t>0&&($("#messageCount").html(t),$(".messageAlert").show())}},error:function(){clearInterval(e)}})}}),$(document).ready(function(){var e=$("#sina-login");e.click(function(){e.button("loading"),window.open("https://api.weibo.com/oauth2/authorize?client_id=3757150196&response_type=code&redirect_uri="+redirect_uri,"_self")}),$(".bt-quick-reply").click(function(){if($(this).parent().siblings(".reply-area").length>0)removeReplyArea(this);else{var e=$(this).parent().parent().siblings(".nickName");e.length<=0&&(e=$(this).parent().parent().parent().siblings(".user-info").find(".nickName"),e.length<=0&&(e=$(this).parent().parent().children(".media-heading").find(".commentUserName")));if(isLogin==0){showAlert("消息","请登录后操作！");return}showReplyInputArea(this,"回复 "+e.html()+":")}})})