function submitCourse(){var e=$(".bt_submit_course");e.button("loading");if(!CheckForm()){e.button("reset");return}showLoading("正在为您提交到教务网..."),$.ajax({type:"POST",contentType:"application/x-www-form-urlencoded; charset=UTF-8",url:"../action/submitCourse",data:$("#course_form").serialize(),error:function(t){addActionResult("服务器出错，请重试！"),e.button("reset"),hideLoading();return},success:function(t){if(t=="system login out time"){addActionResult("教务网登录过期，请重新登录教务网！"),e.button("reset"),showLoginPanel();return}addActionResult(t,"text-success","12"),e.button("reset"),hideLoading()}})}function getCourseList(e,t,n){e.button("loading"),showLoading("正在为您检索数据..."),$("#course_form").hide(),$(".bt_submit_course").attr("disabled","disabled"),$.ajax({type:"POST",contentType:"application/x-www-form-urlencoded; charset=UTF-8",url:"../action/getCourseList",data:{sel_lx:t,SelSpeciality:n},error:function(t){addActionResult("服务器出错，请重试！"),e.button("reset"),hideLoading();return},success:function(t){if(t=="system login out time"){addActionResult("教务网登录过期，请重新登录教务网！"),e.button("reset"),showLoginPanel();return}if(t=="unlogin"){addActionResult("登录超时，请刷新页面，并用微博登录！"),e.button("reset"),hideLoading();return}if(t==""){addActionResult("参数错误，请重试！"),e.button("reset"),hideLoading();return}if(t=="unBind"){addActionResult('1.你可能未绑定教务网账户 <a href="passport?tab=basic">去绑定</a></p><p>2.你可能未绑定上课的校区。 <a href="passport?tab=basic">去绑定校区</a>'),e.button("reset"),hideLoading();return}if(t=="noData"){addActionResult("没有数据！可能是未到选课时间！"),e.button("reset"),hideLoading();return}$("#oTable").html(t),$("#course_form").show(),addActionResult("检索完成","text-success"),e.button("reset"),$(".bt_submit_course").button("reset"),hideLoading()}})}function addActionResult(e,t,n){var r=$(".result_text");r.empty(),t==null&&(t="text-danger");if(n!=null){r.append('<h3 style="font-size:'+n+"px;\"class='"+t+"'>"+e+"</h3>");return}r.append("<h3 class='"+t+"'>"+e+"</h3>")}function login(e,t,n){n.button("loading"),showLoading("正在为您登录教务网..."),$.ajax({type:"POST",contentType:"application/x-www-form-urlencoded; charset=UTF-8",url:"../action/loginSystem",data:{sNo:e,password:t},error:function(e){addActionResult("服务器出错，请重试！"),n.button("reset"),hideLoading();return},success:function(e){if(e=="login out time"){addActionResult("登录超时，请刷新页面，并用微博登录！"),n.button("reset"),hideLoading();return}if(e=="passwordIncorrect"){addActionResult("密码错误"),n.button("reset"),hideLoading();return}if(e=="connect Error"){addActionResult("教务网登录超时，请重试!"),n.button("reset"),hideLoading();return}if(e==""){addActionResult("参数错误，请重试！"),n.button("reset"),hideLoading();return}if(e=="unbind"){addActionResult('1.你可能未绑定教务网账户 <a href="passport?tab=basic">去绑定</a></p><p>2.你可能未绑定上课的校区。 <a href="passport?tab=basic">去绑定校区</a>'),n.button("reset"),hideLoading();return}if(e=="login success"){addActionResult("登录成功","text-success"),n.button("reset"),showLoginSuccessState();return}addActionResult("未知错误，请刷新重试！"),n.button("reset"),hideLoading()}})}function showLoginPanel(){$(".bt_login_academic").show(),$(".login_state").hide(),hideSelectOption(),hideLoading()}function showLoginSuccessState(){$(".bt_login_academic").hide(),$(".login_state").show(),showSelectOption(),hideLoading()}function showLoading(e){$(".result_loading").children("span").html(e),$(".result_loading").show()}function hideLoading(){$(".result_loading").hide()}function hideSelectOption(){$(".use_notice").show(),$(".zx_option").hide()}function showSelectOption(){$(".use_notice").hide(),$(".zx_option").show()}function showListWSXK(e){if($(e).val()=="0"){$("[name='SelSpeciality']").parent().parent().show();return}if($(e).val()=="2"){$("[name='SelSpeciality']").parent().parent().hide();return}}function openWinDialog(e,t){var n='<div class="modal fade in" id="option-WinDialog" tabindex="-2" role="dialog" aria-labelledby="myModalLabel" aria-hidden="false" data-backdrop="static">';n+='<div class="modal-dialog">',n+='<div class="modal-content">',n+='<div class="modal-header">',n+='<button type="button" class="close" data-dismiss="modal" aria-hidden="true">×</button>',n+='<h4 class="modal-title" id="myModalLabel">',n+='请选择上课时间 &nbsp;<span class="text-warning">(2013-2014第二学期)</span>',n+="</h4>",n+="</div>",n+='<div class="modal-body">',n+='<div id="initMsgPanel">',n+='<div class="useLocalData"></div>',n+="<span>正在查询上课信息,请勿刷新或关闭窗口...</span>",n+='<div class="text-center"><img src="../images/result_loading.gif"></div>',n+="</div>",n+='<div id="noticePanel" style="display: none;">',n+='<p class="text-danger">注意:人数一栏不是即时更新的,每个选课时间段更新一次，所以同学们可以大胆加入选课方案！</p>',n+="</div>",n+='<div id="optionList"><div class="data-wrapper">',n+="</div>",n+='<div id="dialog-summary" class="text-danger"></div>',n+="</div>",n+='<div class="modal-footer">',n+='<button id="bt-option-ensure" action-data-cno="040227" type="button" data-loading-text="提交中..." class="btn btn-primary ensure">确定</button>',n+='<button type="button" class="btn btn-default" data-dismiss="modal">取消</button>',n+="</div>",n+="</div>",n+="</div>",n+="</div>";var r=$(n);r.on("click",".ensure",function(e){$(this).button("loading");var n=enSureSelect();try{jsskbj_str=n.split("@")[0],jsskbj_val=n.split("@")[1],n.split("@")[0]=="undefined"&&(jsskbj_str=""),n.split("@")[1]=="undefined"&&(jsskbj_val=""),document.getElementById("chkSKBJstr"+t).value=jsskbj_str,document.getElementById("chkSKBJ"+t).value=jsskbj_val}catch(e){}}),r.on("hidden.bs.modal",function(){r.remove()}),$("body").append(r),r.modal("show");var i=document.getElementById("chkSKBJ"+t).value,s=e.getAttribute("value");zx_getOptionData(s,i,"online")}function enSureSelect(){var e="";try{var t=document.getElementsByTagName("input");for(var n=0;n<t.length;n++)t[n].type=="radio"&&t[n].checked&&e==""&&(e=t[n].value.split("|")[2]);$("#option-WinDialog").modal("hide")}catch(r){}return e}function reLogin(){$("#option-WinDialog").model("hide"),login($("#systemSno"),$("#systemPassword").val(),bt_login_academic)}function zx_getOptionData(e,t,n){var r=$("#option-WinDialog"),i=$('<h4 class="text-danger" > 你可以跳过检索数据，直接使用本地数据.<a href="javascript:void(0)" onclick="zx_getOptionData(\''+e+"','"+t+"','local')\""+">点击使用！</a></h4>");$(".useLocalData").html(i);var s=$('<h4 class="text-center text-danger" > 没有选课信息，可能是教务网没有该选课信息，也可能是网络错误.<a href="javascript:void(0)" onclick="zx_getOptionData(\''+e+"','"+t+"','online')\""+">点击刷新！</a></h4>"),o=$('<h4 class="text-center text-danger" > 选课助手忙不过来了，数据没请求到，请点击刷新.<a href="javascript:void(0)" onclick="zx_getOptionData(\''+e+"','"+t+"','online')\""+">点击刷新！</a></h4>"),u=$('<h4 class="text-center text-danger" > 登录超时，请重新新登录教务网.<a href="javascript:void(0)" onclick="reLogin()">点击刷新！</a></h4>'),a=r.find("#initMsgPanel"),f=r.find("#optionList"),l=r.find("#noticePanel");a.show(),$.get("../action/courseOption?time="+(new Date).getTime(),{value:e,skbjval:t,type:n},function(e){if(e=="state:nothing"){f.empty(),f.append(s),a.hide();return}if(e=="system login out time"){f.empty(),f.append(u),a.hide();return}if(e.indexOf("Request process time exceed th max limit")>=0){f.empty(),f.append(o),a.hide();return}var t="<span>出错啦！！</span>";try{t=$(e)}catch(r){t="<span>出错啦！！</span>"}initOptionData(t);try{f.append(t)}catch(r){}a.hide(),n=="local"&&l.show()})}function initOptionData(e){e.children("#dataListDiv").children("table").find("table").addClass("table table-bordered")}function CheckForm(){var mFlag=!0,mb=!1,mcount,m;mcount=FormAdd.mcount.value;if(mcount>0){for(i=0;i<mcount;i++)eval("FormAdd.chkKC"+i+".checked==true")&&eval("FormAdd.chkKC"+i+".disabled==false")&&(mb=!0,mb==1&&eval("window.document.all.chkSKBJ"+i+".value==''")&&(mFlag=!1));return mb==0?(addActionResult("需选定一门课程！"),!1):mFlag==0?(addActionResult("需选定上课班号→任课教师！"),!1):ChkValue()}}function ChkValue(){var strurl,strid="TTT",s=!1,N,jsskbj_str="",jsskbj_array,xyjc;N=FormAdd.mcount.value;for(i=1;i<=N;i++)if(eval("FormAdd.chkKC"+(i-1)+".checked==true")&&eval("FormAdd.chkKC"+(i-1)+".disabled==false")){eval("jsskbj_str=FormAdd.chkSKBJ"+(i-1)+".value;");if(jsskbj_str!=""){var jsskbj_array=jsskbj_str.split(";");for(j=0;j<jsskbj_array.length;j++)strid+=","+jsskbj_array[j]+"#"+eval("FormAdd.chkKC"+(i-1)+".value")}s=!0}return s?confirm("是否提交记录？")?(FormAdd.id.value=strid,!0):!1:!1}$(function(){var e=$(".bt_login_academic"),t=$(".bt_switch_account"),n=$("#systemSno"),r=$("#systemPassword");t.click(function(){showLoginPanel(),n.attr("disabled")?(n.removeAttr("disabled"),t.html("我的账号")):(n.val(t.attr("osno")),n.attr("disabled","disabled"),t.html("其他账号"))}),e.click(function(){if($("#systemPassword").val()==""){addActionResult("密码不能为空");return}login(n.val(),r.val(),e)});var i=$(".bt-search");i.click(function(){var e=$("#sel_lx").val(),t=$("[name='SelSpeciality']").val();getCourseList(i,e,t)});var s=$(".bt_submit_course");s.click(function(){submitCourse()})})